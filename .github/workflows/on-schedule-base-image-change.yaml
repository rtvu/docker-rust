name: 'On Schedule Base Image Change'

env:
  TAGS: 1.79.0,1.79

on:
  schedule:
    - cron:  '0 7 1,15 * *'
  workflow_dispatch:

jobs:
  on-schedule-base-image-change:
    runs-on: ubuntu-latest
    steps:
      -
        name: 'Check for base image change'
        id: base-image-change
        uses: lucacome/docker-image-update-checker@v1
        with:
          base-image: rtvu/docker-ubuntu:24.04
          image: ${{ github.repository }}:latest
          platforms: linux/amd64,linux/arm64
      -
        name: 'Checkout repository'
        if: steps.base-image-change.outputs.needs-updating == 'true'
        uses: actions/checkout@v4
      -
        name: 'Build and push image'
        if: steps.base-image-change.outputs.needs-updating == 'true'
        uses: rtvu/build-and-push-to-docker-hub-action@v2.0.0
        with:
          image: ${{ github.repository }}
          latest: true
          platforms: linux/amd64,linux/arm64
          tags: ${{ env.TAGS }}
          token: ${{ secrets.DOCKER_HUB_TOKEN }}
          username: ${{ secrets.DOCKER_HUB_USERNAME }}
